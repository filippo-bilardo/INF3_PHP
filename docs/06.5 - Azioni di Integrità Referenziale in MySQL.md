### 6.5 Azioni di Integrità Referenziale in MySQL

L'integrità referenziale garantisce che le relazioni tra le tabelle rimangano coerenti. In MySQL, questo viene gestito tramite vincoli di chiave esterna (`FOREIGN KEY`). Quando si definisce una chiave esterna, è possibile specificare azioni da intraprendere quando una riga a cui si fa riferimento viene aggiornata o eliminata. Le azioni di integrità referenziale includono `CASCADE`, `SET NULL`, `RESTRICT`, `NO ACTION`, e `SET DEFAULT`.

#### 6.5.1 Definizione di Chiavi Esterne

Per definire una chiave esterna in MySQL, si utilizza la sintassi `FOREIGN KEY` durante la creazione o la modifica di una tabella. Esempio:

```sql
CREATE TABLE Ordini (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT,
    data_ordine DATE,
    FOREIGN KEY (cliente_id) REFERENCES Clienti(id)
);
```

#### 6.5.2 Azioni di Integrità Referenziale

- **CASCADE**: Quando una riga a cui si fa riferimento viene eliminata o aggiornata, le righe corrispondenti nella tabella figlia vengono eliminate o aggiornate di conseguenza.

```sql
CREATE TABLE Ordini (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT,
    data_ordine DATE,
    FOREIGN KEY (cliente_id) REFERENCES Clienti(id) ON DELETE CASCADE ON UPDATE CASCADE
);
```

- **SET NULL**: Quando una riga a cui si fa riferimento viene eliminata o aggiornata, i valori delle chiavi esterne nelle righe corrispondenti della tabella figlia vengono impostati su `NULL`.

```sql
CREATE TABLE Ordini (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT,
    data_ordine DATE,
    FOREIGN KEY (cliente_id) REFERENCES Clienti(id) ON DELETE SET NULL ON UPDATE SET NULL
);
```

- **RESTRICT**: Impedisce l'eliminazione o l'aggiornamento di una riga a cui si fa riferimento se esistono righe corrispondenti nella tabella figlia. Questa è l'azione predefinita in MySQL.

```sql
CREATE TABLE Ordini (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT,
    data_ordine DATE,
    FOREIGN KEY (cliente_id) REFERENCES Clienti(id) ON DELETE RESTRICT ON UPDATE RESTRICT
);
```

- **NO ACTION**: Simile a `RESTRICT`, ma la verifica dell'integrità referenziale viene posticipata fino alla fine della transazione.

```sql
CREATE TABLE Ordini (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT,
    data_ordine DATE,
    FOREIGN KEY (cliente_id) REFERENCES Clienti(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
```

- **SET DEFAULT**: Imposta i valori delle chiavi esterne nelle righe corrispondenti della tabella figlia su un valore predefinito. MySQL non supporta direttamente `SET DEFAULT`.

#### 6.5.3 Esempi Pratici

Supponiamo di avere due tabelle: `Clienti` e `Ordini`. Vogliamo garantire che quando un cliente viene eliminato, tutti i suoi ordini vengano eliminati automaticamente.

```sql
CREATE TABLE Clienti (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100)
);

CREATE TABLE Ordini (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT,
    data_ordine DATE,
    FOREIGN KEY (cliente_id) REFERENCES Clienti(id) ON DELETE CASCADE
);
```

In questo esempio, se un cliente viene eliminato dalla tabella `Clienti`, tutti gli ordini associati a quel cliente verranno eliminati automaticamente dalla tabella `Ordini`.

